# Custom API endpoints for QGIS Server plugins
# This file should be mounted to /etc/nginx/conf.d/api-endpoints.conf

# API endpoint for ProjectInfo plugin
location /api/projects {
    fastcgi_pass  localhost:9993;
    fastcgi_param SCRIPT_FILENAME /var/www/data/qgis/qgis_mapserv.fcgi;
    fastcgi_param QUERY_STRING    "SERVICE=PROJECTINFO&REQUEST=GETPROJECTS";
    include fastcgi_params;
}

# API endpoint for specific project details
location ~ ^/api/projects/([^/]+)$ {
    fastcgi_pass  localhost:9993;
    fastcgi_param SCRIPT_FILENAME /var/www/data/qgis/qgis_mapserv.fcgi;
    fastcgi_param QUERY_STRING    "SERVICE=PROJECTINFO&REQUEST=GETPROJECTDETAILS&PROJECT=$1";
    include fastcgi_params;
}

# API endpoint for project-specific services (like WMS, WFS)
location ~ ^/api/projectinfo/([^/]+)$ {
    fastcgi_pass  localhost:9993;
    fastcgi_param SCRIPT_FILENAME /var/www/data/qgis/qgis_mapserv.fcgi;
    fastcgi_param QUERY_STRING    "map=/io/data/$1/$1.qgs&$args";
    include fastcgi_params;
}